extends ../layout.jade
block append head
    title Регистрация
block append body
    // MAIN
    .main
        .registration-form
            h2.reg-fill-heading РЕГИСТРАЦИЯ
            .js-registration
                form#js-registration-form(action="/registration", method="post")
                    .reg-input-lable-container
                        input(type="hidden", name="#{_csrf.parameterName}", value="#{_csrf.token}")
                        .infoBlock
                            if accActivate!=null
                                | #{accActivate}
                        label.reglable Введите адрес эл. почты
                        input.form-control.email_input.not-morph(name='email', type='text')
                        .errors#emailError
                        label.reglable Введите пароль
                        input.form-control.password_input.not-morph(name='password', type='password')
                        .errors#passwordError
                        input.form-control.yes.registration-button.reginp(type='submit', value='Зарегистрироваться')

    // MAIN END
    // SCRIPTS
    if loginError
        script.
            $(document).ready(function(){
                document.getElementById('login').click();
                $('.morph-content').show();
                $('#loginErrorMessage').html("Введён неверный Email или пароль.");
                $('.errorOutline').addClass("red-error");
            })
    script(src='/resources/scripts/classie.js')
    script(src='/resources/scripts/uiMorphingButton_fixed.js')
    script.
        (function () {
            var docElem = window.document.documentElement, didScroll, scrollPosition;
            // trick to prevent scrolling when opening/closing button
            function noScrollFn() {
                window.scrollTo(scrollPosition ? scrollPosition.x : 0, scrollPosition ? scrollPosition.y : 0);
            }
            function noScroll() {
                window.removeEventListener('scroll', scrollHandler);
                window.addEventListener('scroll', noScrollFn);
            }
            function scrollFn() {
                window.addEventListener('scroll', scrollHandler);
            }
            function canScroll() {
                window.removeEventListener('scroll', noScrollFn);
                scrollFn();
            }
            function scrollHandler() {
                if (!didScroll) {
                    didScroll = true;
                    setTimeout(function () {
                        scrollPage();
                    }, 60);
                }
            };
            function scrollPage() {
                scrollPosition = {
                    x: window.pageXOffset || docElem.scrollLeft,
                    y: window.pageYOffset || docElem.scrollTop
                };
                didScroll = false;
            };
            scrollFn();
            [].slice.call(document.querySelectorAll('.morph-button')).forEach(function (bttn) {
                new UIMorphingButton(bttn, {
                    closeEl: '.icon-close',
                    onBeforeOpen: function () {
                        // don't allow to scroll
                        noScroll();
                    },
                    onAfterOpen: function () {
                        // can scroll again
                        canScroll();
                    },
                    onBeforeClose: function () {
                        // don't allow to scroll
                        noScroll();
                    },
                    onAfterClose: function () {
                        // can scroll again
                        canScroll();
                    }
                });
            });
            // for demo purposes only
            [].slice.call(document.querySelectorAll('form button')).forEach(function (bttn) {
                bttn.addEventListener('click', function (ev) {
                    ev.preventDefault();
                });
            });
        })();
    script(type='text/javascript').
        function DropDown(el) {
            this.dd = el;
            this.initEvents();
        }
        DropDown.prototype = {
            initEvents: function () {
                var obj = this;
                obj.dd.on('click', function (event) {
                    $(this).toggleClass('active');
                    event.stopPropagation();
                });
            }
        }
        $(function () {
            var js_info_button = new DropDown($('#js_info_button'));
            $(document).click(function () {
                // all dropdowns
                $('.info-button').removeClass('active');
            });
        });
    //SCRIPTS END